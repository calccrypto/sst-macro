<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>SST/macro: Basic MPI Program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customthing.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SST/macro
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Basic MPI Program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_tutorial_basicmpi"></a>
Basic MPI Program</h1>
<p>Let us go back to the simple send/recv skeleton and actually look at the code.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstmac/sstmpi.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sstmac_2util_8h.html">sstmac/util.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> user_skeleton_main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) </div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> message_size = 128;</div>
<div class="line">    <span class="keywordtype">int</span> me, nproc;</div>
<div class="line">    <span class="keywordtype">int</span> tag = 0;</div>
<div class="line">    <span class="keywordtype">int</span> dst = 1;</div>
<div class="line">    <span class="keywordtype">int</span> src = 0;</div>
<div class="line">    MPI_Status stat;</div>
<div class="line"></div>
<div class="line">    MPI_Init(&amp;argc,&amp;argv);</div>
<div class="line">    MPI_Comm world = MPI_COMM_WORLD;</div>
<div class="line">    MPI_Comm_rank(world,&amp;me);</div>
<div class="line">    MPI_Comm_size(world,&amp;nproc);</div>
</div><!-- fragment --><p> The starting point is creating a main routine for the application, which should be named <code>user_skeleton_main</code>. When SST/macro launches, it will invoke this routine and pass in any command line arguments specified via the <code>launch_app1_argv</code> parameter. Upon entering the main routine, the code is now indistinguishable from regular MPI C code. In the parameter file to be used with the simulation, you must set</p>
<div class="fragment"><div class="line">launch_app1 = user_mpiapp_c</div>
</div><!-- fragment --><p> or, if compiling as C++</p>
<div class="fragment"><div class="line">launch_app1 = user_mpiapp_cxx</div>
</div><!-- fragment --><p>At the very top of the file, the SST/macro header files must be included. This header provides the MPI API and configures MPI function calls to link to SST/macro instead of the real MPI library. In most cases, only <code>sstmpi.h</code> will be needed, but <code>util.h</code> contains utility functions that may be useful. If trying to maintain code as "single-source'' compilable without modification for both SST/macro and actual MPI, we recommend creating a <code>parallel.h</code>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifdef SSTMACRO</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;sstmac/sstmpi.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sstmac_2util_8h.html">sstmac/util.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#define USER_MAIN user_skeleton_main</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="mpi_8h.html">mpi.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#define USER_MAIN main</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p> This creates a central point for swapping back and forth. The beginning of the file would then become</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;parallel.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="skeleton_8h.html#a5357a5c38574ff971774df511a4e36d3">USER_MAIN</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) </div>
<div class="line">{</div>
</div><!-- fragment --><p>The end of the file is again just regular MPI C code:</p>
<div class="fragment"><div class="line">    <span class="keywordflow">if</span> (nproc != 2) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;sendrecv only runs with two processors\n&quot;</span>);</div>
<div class="line">        abort();</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (me == 0) {</div>
<div class="line">        MPI_Send(NULL, message_size, MPI_INT, dst, tag, world);</div>
<div class="line">        <a class="code" href="namespacesprockit.html#aaaf1619b98e45002bd1b0c6022c29aa0">printf</a>(<span class="stringliteral">&quot;rank %i sending a message\n&quot;</span>, me);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        MPI_Recv(NULL, message_size, MPI_INT, src, tag, world, &amp;stat);</div>
<div class="line">        <a class="code" href="namespacesprockit.html#aaaf1619b98e45002bd1b0c6022c29aa0">printf</a>(<span class="stringliteral">&quot;rank %i receiving a message\n&quot;</span>, me);</div>
<div class="line">    }</div>
<div class="line">    MPI_Finalize();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> Here the code just checks the MPI rank and sends (rank 0) or receives (rank 1) a message. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 16 2016 16:24:38 for SST/macro by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
